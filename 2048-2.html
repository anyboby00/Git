<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		#div1 {
			margin: 100px auto 0;
			width: 450px;
			height: 450px;
			border: 1px solid #000;
		}
		#div1 div {
			margin: 10px 0 0 10px;
			width: 100px;
			height: 100px;
			float: left;
			background: #ccc;
			font-size: 60px;
			line-height: 100px;
			text-align: center;
			font-weight: bold;

			animation-iteration-count: 1;
			animation-duration: .3s;
			/*animation-name: 'miaov';*/
		}

		@keyframes miaov {
			50% {font-size: 80px;background:red;}
			100% {font-size: 60px;background:#ccc;}
		}
	</style>
	<script type="text/javascript">
		
		function _2048(arr) {

			var newArr = [];

			for (var i=arr.length-1; i>=0; ) {
				var a = arr[i];
				if (a == 0) {
					i--;
					continue;
				} else {
					i--;
					var b = 0;
					while (b == 0 && i >= 0) {
						b = arr[i];
						if (i >= 0) {
							i--;
						} else {
							break;
						}
					}

					if (b == 0) {
						newArr.push(a);
						break;
					} else if (a == b) {
						newArr.push(a + b);
					} else {
						newArr.push(a);
						i++;
					}

				}

			}

			for (var i=0; i<4; i++) {
				newArr[i] = newArr[i] || 0;
			}

			return newArr.reverse();
		}

		// var result = _2048([0,4,0,4]);
		// console.log(result)

		window.onload = function() {

			var divs = document.querySelectorAll("#div1 div");

			function todo(a, b, c, d) {
				var arr = [
					Number(divs[a].innerHTML),
					Number(divs[b].innerHTML),
					Number(divs[c].innerHTML),
					Number(divs[d].innerHTML)
				];
				//console.log(arr)
				var newArr = _2048(arr);
				//console.log(newArr)
				//console.log(a, b, c, d);
				divs[a].innerHTML = newArr[0] || '';
				divs[b].innerHTML = newArr[1] || '';
				divs[c].innerHTML = newArr[2] || '';
				divs[d].innerHTML = newArr[3] || '';

				if (newArr[0]) {
					divs[a].style.animationName = 'miaov';
				}
				if (newArr[1]) {
					divs[b].style.animationName = 'miaov';
				}
				if (newArr[2]) {
					divs[c].style.animationName = 'miaov';
				}
				if (newArr[3]) {
					divs[d].style.animationName = 'miaov';
				}
			}

			function random2() {
				//获取到divs中是空格的div
				var arr = [];
				for (var i=0; i<divs.length; i++) {
					if (divs[i].innerHTML == '') {
						arr.push(divs[i]);
					}
				}
				arr.sort(function() {
					return 0.5 - Math.random();
				});
				arr[0].innerHTML = 2;
			}

			random2();

			for (var i=0; i<divs.length; i++) {
				divs[i].addEventListener("animationend", function() {
						this.style.animationName = '';
				}, false);
			}

			document.onkeydown = function(e) {

				switch(e.which) {

					case 37:
						todo(3,2,1,0);
						todo(7,6,5,4);
						todo(11,10,9,8);
						todo(15,14,13,12);
						random2();
						break;

					case 38:
						todo(12,8,4,0);
						todo(13,9,5,1);
						todo(14,10,6,2);
						todo(15,11,7,3);
						random2();
						break;

					case 39:
						todo(0,1,2,3);
						todo(4,5,6,7);
						todo(8,9,10,11);
						todo(12,13,14,15);
						random2();
						break;

					case 40:
						todo(0,4,8,12);
						todo(1,5,9,13);
						todo(2,6,10,14);
						todo(3,7,11,15);
						random2();
						break;

				}

			}

			//初始化


		}

	</script>
</head>
<body>
	
	<div id="div1">
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
		<div></div>
	</div>

</body>
</html>